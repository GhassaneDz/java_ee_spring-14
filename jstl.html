<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Java ee spring-14 by gdufrene</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Java EE / Spring</h1>
        <p>Master e-services 2015</p>
        <p class="view"><a href="https://github.com/gdufrene/java_ee_spring-14">View the Project on GitHub <small>gdufrene/java_ee_spring-14</small></a></p>
        <ul>
          <li><a href="https://github.com/gdufrene/java_ee_spring-14/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/gdufrene/java_ee_spring-14/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/gdufrene/java_ee_spring-14">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>

        <h3> Avant de commencer ... </h3>

        <p>( <i style="color: #3333AA">autonomie</i> )</p>

        <p>
          <i class="icon-star">★</i>
          Rendez-vous sur <a href="http://goo.gl/forms/PhVlyuVSv4">ce formulaire</a> et estimez en "Story Point" chacune des fonctionnalités.<br/>
          
        </p>

        <h2> <a name="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages"><span class="octicon octicon-link"></span></a>JSTL.
        </h2>

<p>
  JSP Standard Tag Library (JSTL) est une librairie qui étend les fonctionnalités de JSP en mettant à disposition de nouveaux tags à utiliser dans le HTML. L'objectif est de permettre d'écrire du code plus facilement et de manière plus cohérente avec le reste du HTML. <br/>
  Ainsi, un développeur front-end ne sera pas trop perdu dans l'utilisation de ces balises, même si il ne connait rien à JAVA.
</p>

<p>
  L'implémentation de base fourni différents types de balises regroupées dans différents espaces de nommage XML. Comprenez différents module dont on identifiera le nom dans le préfixe de la balise. Il existe ainsi les tags "core" (c), les tags "xml" (x), les tags "format" (fmt) et les tags "sql" (sql).
</p>

<p>
  JSTL 1.2 offre également des facilités pour la manipulation et l'affichage des données provenant du "model". Cela va se faire par ce qui est nommé "Expression Language" (EL). Une expression est une chaine du type <code>${expression}</code>. "expression" peut simplement être le nom d'une variable du modèle ou une fonction plus aboutie fournie par EL.
</p>

<p>
  Pour indiquer à notre compilateur JSP que notre page utilisera JSTL et EL, il suffit de placer cette déclaration de la taglib en haut de notre page JSP.<br/>
  <code>&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jstl/core&quot; %&gt;</code><br/>
  Ensuite les balises préfixées par "c" seront interprétées par le compilateur et généreront du code java particulier.<br/>
</p>

<h3> Liste des tags du "core" </h3>

<p>
  La taglib "core" fourni un ensemble de tag permettant de gérer de l'affichage et affectation de variable, des boucles, des conditions, de la création d'url en fonction du contexte, des redirections ...<br/>
<p>

<p>
  <table class="src">
  <tbody><tr><th style="width:30%">Tag</th><th>Description </th></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_out_tag.htm">&lt;c:out &gt;</a></td>
    <td>Identique à &lt;%= ... &gt;, mais pour les expressions. </td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_set_tag.htm">&lt;c:set &gt;</a></td>
    <td>Affecte le résultat d'une expression à un 'scope'</td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_remove_tag.htm">&lt;c:remove &gt;</a></td>
    <td>Efface une variable (Depuis un scope, si défini). </td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_catch_tag.htm">&lt;c:catch&gt;</a></td>
    <td>Gère les exception 'Throwable' qui surviennent dans le contenu du tag.</td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_if_tag.htm">&lt;c:if&gt;</a></td>
    <td>Tag permettant de traiter une condition (if).</td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_choose_tag.htm">&lt;c:choose&gt;</a></td>
    <td>Tag permettant de gérer un ensemble de conditions exclusives (identique à switch/break). </td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_choose_tag.htm">&lt;c:when&gt;</a></td>
    <td>Sous-tag de 'choose' pour traiter une condition.</td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_choose_tag.htm">&lt;c:otherwise &gt;</a></td>
    <td>Sous-tag de 'choose' pour traiter tout autre cas que ceux indiquer dans 'when'.</td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_import_tag.htm">&lt;c:import&gt;</a></td>
    <td>Affecte le contenu d'une page pointée par une URL à une variable.</td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_foreach_tag.htm">&lt;c:forEach &gt;</a></td>
    <td>Permet de faire une boucle sur tout ce qui est 'Iterable' ou tableaux.</td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_foreach_tag.htm">&lt;c:forTokens&gt;</a></td>
    <td>Boucle sur une chaine possédant un séparateur défini (exemple 'chaine1,chaine2,chaine3').</td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_redirect_tag.htm">&lt;c:redirect &gt;</a></td>
    <td>Redirige l'utilisateur vers une nouvelle URL.</td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_url_tag.htm">&lt;c:url&gt;</a></td><td>Crée une URL absolue en fonction du contexte de la servlet, avec des paramètres ou non.</td></tr>
  <tr><td><a href="http://www.tutorialspoint.com/jsp/jstl_core_param_tag.htm">&lt;c:param&gt;</a></td>
    <td>Sous-tag de 'URL' permettant d'ajouter (ou remplacer) un paramètre à la Query String.</td></tr>
  </tbody></table>
  <center>source : <a href="http://www.tutorialspoint.com/jsp/">tutorialpoint.com</a></center>
</p>

<p>
  Les autres taglibs ne devraient pas vous être utile dans le cadre de ce cours.<br/>
  <ul><li>  "xml" : permet de traiter ou requêter une structure xml
  </li><li> "format" : permet de gérer l'internationnalisation des contenus de page et des formats (date, monnaies ...)
  </li><li> "sql" : permet d'exécuter des requêtes SQL directement et facilement depuis une page JSP.<br/>
    Dans le cadre de nos développements cela ne s'avère pas être une bonne pratique.<br/>
    Cela reste toutefois utile pour de petits développements dont le périmètre est restreint à un type de base.
  </li></ul>
</p>

<h3> Mise en oeuvre dans notre projet avec Spring </h3>

<p>
  Tous les objets affectés au modèle sont exposés de manière immédiate par les EL.<br/>
  Pour reprendre l'exemple de la liste des auteurs, si l'on a fait ceci dans notre contrôleur :<br/>
  <pre><code>
    List&lt;Author&gt; authors = dao.listAll();
    model.addAttribute("authors", authors);
  </code></pre>
  Alors, il sera facile de faire une itération sur nos auteurs dans la vue avec le bout de code :<br/>
  <pre><code>
    &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;
    &lt;h1&gt;Auteurs&lt;/h1&gt;

    &lt;c:choose&gt;
      &lt;c:when test=&quot;${empty authors}&quot;&gt;
      Liste des auteurs vide
      &lt;/c:when&gt;
      &lt;c:otherwise&gt;
      &lt;ul&gt;
       &lt;c:forEach items=&quot;${authors}&quot; var=&quot;author&quot;&gt;
        &lt;li&gt;${author.firstname} ${author.lastname}&lt;/li&gt;
       &lt;/c:forEach&gt;
      &lt;/ul&gt;
      &lt;/c:otherwise&gt;
    &lt;/c:choose&gt;
  </code></pre>
  Notez qu'il n'y a pas de "else" à la balise <code>&lt;c:if&gt;</code>. Nous pouvons par contre utiliser "<code>choose</code>" et "<code>otherwise</code>" comme ici.<br/>
  Pour que l'expression "<code>${author.firstname}</code>" fonctionne, il est nécessaire d'avoir un getter sur la propriété "firstname". Par convention les propriétés d'un objets sont résolue selon la norme "javabeans". Donc, il faut créer des getters sur les propriétés que vous voulez exposer dans vos vues.
</p>

<h3> La taglib form de spring </h3>

<p>
  De nouvelles taglib peuvent être créées afin d'enrichir les fonctionnalités offertes dans les vues.<br/>
  Spring fournit une taglib "form" bien pratique pour manipuler les objets java à éditer dans des formulaires HTML.<br/>
  Apprenons par l'exemple en observant ce que cela peut donner sur nos auteurs.
<pre><code>
  &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;
  &lt;%@ taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot; %&gt;

  &lt;h1&gt;Author&lt;/h1&gt;

  &lt;form:form modelAttribute=&quot;author&quot;&gt;
  &lt;form:input type=&quot;hidden&quot; path=&quot;id&quot; /&gt; &lt;br/&gt;
  firstname : &lt;form:input path=&quot;firstname&quot; /&gt; &lt;br/&gt;
  lastname :&lt;form:input path=&quot;lastname&quot; /&gt; &lt;br/&gt;
  &lt;input type=&quot;submit&quot; value=&quot;Enregistrer&quot;/&gt;
  &lt;/form:form&gt;
</code></pre>

Vous pouvez consulter la documentation dédiée aux vues spring et plus particulièrement la section "<a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/view.html#view-jsp-formtaglib">comment utiliser la taglib form</a>".
</p>

<p>
  Du côté de notre contrôleur il sera nécessaire de distinguer deux opérations. Une première pour traiter l'affichage du formulaire (en GET) et une deuxième pour gérer l'enregistrement des données du formulaire  (en POST) et mettre à jour les données dans la base. Quelques annotations nous serons utiles pour distinguer les deux opérations branchées sur la même URL. Une annotation <code class="ann">@PathVariable</code> nous permettra d'extraire facilement une variable depuis l'url. L'annotation <code class="ann">@ModelAttribute</code> permettra de créer un objet automatiquement à partir des données du formulaire envoyé en POST. Toutefois, pour que cela fonctionne vous devez exposer des "setter" sur les propriétés de votre model selon la convention "javabeans".<br/>
  Le code du contrôleur ressemblera au final à cela :<br/>
<pre><code>
	@RequestMapping(value=&quot;/author/{id}.html&quot;, method=RequestMethod.GET)
	public String edit( Model model, @PathVariable(&quot;id&quot;) int id ) {
		Author author = dao.find(id);
		model.addAttribute(&quot;author&quot;, author);
		return &quot;author/edit&quot;;
	}
	
	@RequestMapping(value=&quot;/author/{id}.html&quot;, method=RequestMethod.POST)
	public String save( Model model, @ModelAttribute Author author ) {
		dao.update(author);
		model.addAttribute(&quot;author&quot;, author);
		return &quot;author/edit&quot;;
	}
</code></pre>
</p>

<h3> complément sur les objets injectables avec spring web-mvc </h3>

<p>
  Dans notre contrôleur, nous définissons un ensemble d'opération et nous les branchons sur des URL.<br/>
  Spring est capable de gérer les appels à ces opérations en fournissant automatiquement en paramètre les objets nécessaires.<br/>
  Ainsi, si pour des besoins particuliers vous avez besoin d'un paramètre fourni en GET ou en POST, vous pourriez ajouter un paramètre annoté <code class="ann">@RequestParam</code>
<pre><code>
  	@RequestMapping(value=&quot;/authors.html&quot;, method=RequestMethod.GET)
  	public String listByName( Model model, @RequestParam(&quot;nameLike&quot;) String name ) {
  		List&lt;Author&gt; authors = dao.findAuthorsLikeName( name );
  		model.addAttribute(&quot;authors&quot;, authors);
  		return &quot;authors&quot;;
  	}
</code></pre>
  Cette opération serait accessible via l'url "http://localhost:8080/tp1/authors.html?nameLike=Cat" et permettrait de lister les auteurs dont le nom commence par "Cat". Le paramètre "nameLike" est ici passé dans la QueryString de la requête, en GET. Cela aurait pu être dans le corps d'une requête POST.
</p>

<p>
  Si vous avez besoin d'accéder à l'objet HttpServletRequest (ou Response) il vous suffit de l'ajouter à la liste des paramètres de votre opération et spring vous le passera lors de l'invocation de la méthode.<br/>
  Il n'est pas recommandable de créer ce type de dépendance vers l'API servlet car votre contrôleur pourrait être utilisé dans un tout autre contexte que celui d'une application web. Toutefois, il est parfois nécessaire de le faire et spring vous en offre la possibilité.<br/>
  Consulter <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-arguments">cette page</a> pour voir la liste des types de paramètres que spring peut vous fournir !<br/>
</p>

<h2> Projet </h2>

<div class="note">
  Formez des équipes de 3 ou 4 et choisissez les fonctionnalités que vous souhaitez développer par celles estimées plus haut. <br/>
  Il faudra mettre en oeuvre tout ce que vous avez vu durant ce cours Java EE : Servlet (si néceassaire), JSP et JSTL, Spring, JPA ...<br/>
  Utilisez Git ! Partagez-vous un projet et chacun utilisera son compte git bitbucket. Les logs de commit doivent être représentatif de la régularité de votre travail et de l'investissement de chacun.<br/>
  <br/>
  Une même fonctionnalité ne POURRA PAS être développée par plus de 2 équipes.<br/>
  Deux équipes ne peuvent pas développer toutes les même fonctionnalités. Faîtes des choses différentes !<br/>
  Organisez-vous comme vous le souhaitez pour vous répartir les tâches entre groupe.<br/>
  Les membres d'un groupe DOIVENT se partager le travail de manière transverse, quelqu'un ne doit pas faire QUE du html/JSP par exemple.<br/>
  <br/>
  Votre projet doit être facile à récupérer, à "installer" et à lancer. Pensez à y mettre un README (voir <a href="introduction.html#12">cours 1</a>).<br/>
  <br/>
  Votre Note individuelle prend en compte tous les exercices précédents (check.jar et travail en autonomie) et votre contribution au projet en groupe.<br/>
</div>

<ul class="navigation">
  <li>
    <a href="spring.html"><strong> &laquo; Spring </strong></a>
  </li>
  <li>
    <a href="index.html"> <strong>^ Sommaire ^</strong> </a>
  </li>
  <li>
    <a href="#"> <strong>( a suivre )</strong> </a>
  </li>
</ul>

</section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/gdufrene">gdufrene</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
